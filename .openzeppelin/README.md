# установка-токена-блокировка
Контракт на выпуск токенов равными частями через равные промежутки времени.

## Истоки
Этот контракт является измененной версией TokenTimeLock Open Zeppelin и отличается только графиком выплат. Проверенные безопасные коды, такие как SafeMath, Address и SafeERC20, были оставлены нетронутыми для безопасного и надежного общества, которого, я уверяю, хватит на десять тысяч лет.

Контракт о блокировке может использоваться для распределения регулярных платежей на кошелек получателя, чтобы установить доверие сообщества. Однако он достаточно гибкий, чтобы использовать его в качестве средства личных сбережений или устройства сглаживания потребления, позволяя передавать нерегулярный или редкий доход на посекундной основе.

## Поток состояний

Замок существует в 2-х состояниях:

1. Бездействующий. После развертывания нет графика перехода прав, пока не будет активирована функция депозита. Как только все платежи произведены, контракт снова бездействует.
2. Облачение. После внесения депозита время начала устанавливается на текущее время блокировки, и начинается график платежей.

Чтобы инициализировать временную блокировку, мы сначала должны установить параметры. Функция initialize имеет следующие параметры:
*адрес токена, адрес получателя, тип продолжительности, кратность продолжительности и периоды*

Последние 3 временных параметра обсуждаются ниже.

После инициализации все, что требуется для перевода контракта в состояние перехода, -это вызвать функцию депозита с желаемым количеством токенов. Имейте в виду, что вам потребуется ERC20.утвердить адрес токена блокировки и что переменная суммы выражается в базовых (wei) единицах. Итак, если ваш токен имеет 18 знаков после запятой, для отправки 1 токена необходимо ввести число 1000000000000000000.

## Применение

После развертывания контракта Lock график перехода прав не активируется до тех пор, пока вы не вызовете функцию «Депозит», установив время начала на «сейчас».
Перед вызовом депозита убедитесь, что на кошельке звонящего есть достаточный баланс, соответствующий указанной сумме, и что для контракта блокировки было получено одобрение ERC20.

Получатель должен вызвать функцию деблокирования, чтобы потребовать накопленные платежи.

### Периоды времени

Одним из параметров функции инициализации является продолжительность, которая принимает число в качестве ключа, представляющего одно из следующих значений:
``
        секунда = 0,
        минута = 1,
        час = 2,
        день = 3,
        неделя = 4,
        месяц = 5, //неточно, предполагается 30-дневный месяц, с учетом дрейфа
        год = 6,
        квартал = 7, //13 недель
        biannual = 8 //26 недель
``
В дополнение к типу продолжительности вы можете установить кратность продолжительности. Например. если продолжительность установлена ​​на 5, а кратная -на 3, тогда продолжительность между снятием средств составляет 3 недели.
Если вы установите длительность на число больше 8, то продолжительность будет соответствовать этому числу в секундах. Например, если я установлю продолжительность на 4000, то каждый период будет длиться 4000 секунд.

Наконец, параметр периодов определяет, на сколько периодов будут разделены платежи. Например
Для длительности = 2, кратной длительности = 1 и периодов = 3 будет три платежа с интервалом в час каждый.

### Депозит при переходе

Если контракт находится в состоянии перехода, вызов функции «Депозит» приведет к перерасчету платежей, чтобы гарантировать, что весь баланс будет выплачен до последнего периода.

Например, предположим, что контракт развернут на 12 ежемесячных выплат токена Dai. Депозит составляет 24000 дай, чтобы каждый месяц выпускалось 2000 дай. После 3-го месяца остается 18000 Дай и 9 периодов. Функция депозита вызывается со значением 9000 дай. Итого теперь 27000 Дай, осталось 9 периодов. Контракт немедленно корректирует ежемесячные платежи, так что баланс достигнет нуля через 9 месяцев. Новый ежемесячный платеж составляет (27000/9 =) 3000 Дай.

## Ограничения

Контракт блокировки в настоящее время поддерживает только токены ERC20 и не поддерживает ETH. Кошелек получателя может быть изменен только тогда, когда контракт неактивен, чтобы сохранить доверие в случае передачи токенов командой.

# Настройка для локального запуска

Для тестирования вам понадобится глобальный экземпляр ganache-cli, а также трюфель.

``
    npm install -g трюфель
    npm install -g ganache-cli
``

установить библиотеки Openzeppelin через npm:
``
    npm install
``

Для тестирования вам потребуется запустить ganache-cli. Для базового экземпляра ganache-cli, если вы используете операционную систему POSIX, предоставлен сценарий:
``
./ganache.sh
``

в противном случае просто запустите ganache-cli с настройками по умолчанию.

В отдельном окне запустить
``
    трюфельный тест
``